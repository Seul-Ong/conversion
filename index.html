<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê³ ì´ ìƒì¡° í”„ë¡œì ì…˜ íˆ´ v2.3</title>
    <link href="https://cdn.jsdelivr.net/gh/spoqa/spoqa-han-sans@latest/css/SpoqaHanSansNeo.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Spoqa Han Sans Neo', -apple-system, BlinkMacSystemFont, sans-serif;
            background: #f5f7fa;
            color: #2c3e50;
            font-size: 14px;
            padding: 20px;
        }
        .container { max-width: 1400px; margin: 0 auto; }
        header {
            background: linear-gradient(135deg, #f18334 0%, #e76f1f 100%);
            color: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(241, 131, 52, 0.3);
            margin-bottom: 30px;
        }
        h1 { font-size: 28px; margin-bottom: 8px; font-weight: 700; }
        .subtitle { opacity: 0.95; font-size: 14px; }
        .card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            margin-bottom: 20px;
        }
        .card h2 {
            font-size: 18px;
            margin-bottom: 20px;
            color: #2c3e50;
            border-bottom: 2px solid #f18334;
            padding-bottom: 10px;
            font-weight: 700;
        }
        .summary-box {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }
        .summary-item {
            background: #edeae9;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
        }
        .summary-label { font-size: 12px; color: #6c757d; margin-bottom: 8px; }
        .summary-value { font-size: 28px; font-weight: 700; color: #f18334; }
        .summary-unit { font-size: 14px; color: #6c757d; margin-left: 3px; }
        .data-table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        .data-table th, .data-table td {
            padding: 12px;
            text-align: center;
            border: 1px solid #e9ecef;
            font-size: 13px;
        }
        .data-table th { background: #f8f9fa; font-weight: 600; color: #495057; }
        .data-table input {
            width: 100%;
            padding: 8px;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            font-size: 13px;
            text-align: center;
        }
        .data-table .actual { background: #e8f5e9; }
        .data-table .forecast { background: #fff3e0; }
        .info-box {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 4px;
            font-size: 13px;
            line-height: 1.6;
        }
        .info-box.warning { background: #fff3e0; border-left-color: #ff9800; }
        .info-box.success { background: #e8f5e9; border-left-color: #4caf50; }
        .radio-group {
            display: flex;
            gap: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            justify-content: center;
            margin-bottom: 20px;
        }
        .radio-group label {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            padding: 10px 15px;
            border-radius: 6px;
            transition: all 0.3s;
        }
        .radio-group label:hover { background: #e9ecef; }
        .radio-group input[type="radio"] { width: 18px; height: 18px; }
        .chart-container { position: relative; height: 350px; margin-top: 20px; }
        .version-badge {
            display: inline-block;
            background: rgba(255,255,255,0.2);
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            margin-left: 10px;
        }
        .change-note { font-size: 12px; color: rgba(255,255,255,0.8); margin-top: 5px; }
        .year-section { margin-top: 15px; padding: 10px; background: #f8f9fa; border-radius: 8px; }
        .year-section h4 { font-size: 14px; color: #495057; margin-bottom: 10px; }
        @media (max-width: 1024px) {
            .summary-box { grid-template-columns: repeat(2, 1fr); }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ“Š ê³ ì´ ìƒì¡° í”„ë¡œì ì…˜ íˆ´ v2.3 <span class="version-badge">250120</span></h1>
            <p class="subtitle">ì‹¤ì¸¡ ê¸°ë°˜ ì „í™˜ìœ¨ ëª¨ë¸ Â· 2024 Q3 ~ 2028ë…„ ì˜ˆì¸¡ (3ê°œë…„ ê³„íš)</p>
            <p class="change-note">v2.2 â†’ v2.3: 1ë…„ì°¨ 1.2%â†’0.8%, ê· ë“±â†’Front-loaded, 2025 Q4 ì‹¤ì  ë°˜ì˜, 2028ë…„ í™•ì¥</p>
        </header>
        
        <!-- ëª¨ë¸ ì„¤ì • -->
        <div class="card">
            <h2>âš™ï¸ ì „í™˜ìœ¨ ì‹œë‚˜ë¦¬ì˜¤ ì„ íƒ</h2>
            <div class="info-box">
                <strong>ğŸ“Œ v2.3 ëª¨ë¸ íŠ¹ì§•:</strong><br>
                â€¢ 1ë…„ì°¨ ì „í™˜ìœ¨: <strong>0.8%</strong> (ì‹¤ì¸¡ ê°€ì¤‘í‰ê·  ê¸°ë°˜, v2.2 ëŒ€ë¹„ -33%)<br>
                â€¢ ì›”ë³„ íŒ¨í„´: <strong>Front-loaded</strong> (ì „ë°˜ë¶€ 0-5ê°œì›”ì— 63% ì§‘ì¤‘)<br>
                â€¢ 2ë…„ì°¨ ì´í›„: Lognormal ê°ì‡  + ì‹¤ì¸¡ ê°ì‡ ìœ¨ ë°˜ì˜
            </div>
            <div class="radio-group">
                <label>
                    <input type="radio" name="scenario" value="conservative" checked>
                    <span><strong>ë³´ìˆ˜ì  (10ë…„ 7%)</strong><br><small>1ë…„ì°¨ 0.8% â†’ 10ë…„ì°¨ 7.0%</small></span>
                </label>
                <label>
                    <input type="radio" name="scenario" value="neutral">
                    <span><strong>ì¤‘ë¦½ì  (10ë…„ 9%)</strong><br><small>1ë…„ì°¨ 0.8% â†’ 10ë…„ì°¨ 8.7%</small></span>
                </label>
            </div>
        </div>
        
        <!-- Summary Cards -->
        <div class="card">
            <h2>ğŸ¯ ì—°ë„ë³„ ì˜ˆì¸¡ ìš”ì•½</h2>
            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px;">
                <div>
                    <h4 style="text-align:center; margin-bottom:10px; color:#6c757d;">2026ë…„</h4>
                    <div class="summary-box" style="grid-template-columns: repeat(2, 1fr);">
                        <div class="summary-item">
                            <div class="summary-label">ì „í™˜ ê³ ê°</div>
                            <div class="summary-value" id="total2026Conversion" style="font-size:24px;">-<span class="summary-unit">ëª…</span></div>
                        </div>
                        <div class="summary-item">
                            <div class="summary-label">ë§¤ì¶œ</div>
                            <div class="summary-value" id="total2026Revenue" style="font-size:24px;">-<span class="summary-unit">ì–µ</span></div>
                        </div>
                    </div>
                </div>
                <div>
                    <h4 style="text-align:center; margin-bottom:10px; color:#6c757d;">2027ë…„</h4>
                    <div class="summary-box" style="grid-template-columns: repeat(2, 1fr);">
                        <div class="summary-item">
                            <div class="summary-label">ì „í™˜ ê³ ê°</div>
                            <div class="summary-value" id="total2027Conversion" style="font-size:24px;">-<span class="summary-unit">ëª…</span></div>
                        </div>
                        <div class="summary-item">
                            <div class="summary-label">ë§¤ì¶œ</div>
                            <div class="summary-value" id="total2027Revenue" style="font-size:24px;">-<span class="summary-unit">ì–µ</span></div>
                        </div>
                    </div>
                </div>
                <div>
                    <h4 style="text-align:center; margin-bottom:10px; color:#6c757d;">2028ë…„</h4>
                    <div class="summary-box" style="grid-template-columns: repeat(2, 1fr);">
                        <div class="summary-item">
                            <div class="summary-label">ì „í™˜ ê³ ê°</div>
                            <div class="summary-value" id="total2028Conversion" style="font-size:24px;">-<span class="summary-unit">ëª…</span></div>
                        </div>
                        <div class="summary-item">
                            <div class="summary-label">ë§¤ì¶œ</div>
                            <div class="summary-value" id="total2028Revenue" style="font-size:24px;">-<span class="summary-unit">ì–µ</span></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Input Section -->
        <div class="card">
            <h2>ğŸ“¥ ê°€ì… ë°ì´í„°</h2>
            
            <h3 style="font-size: 16px; margin: 20px 0 10px 0;">âœ… ê³¼ê±° ê°€ì… ì‹¤ì  (í™•ì •)</h3>
            <table class="data-table">
                <thead>
                    <tr><th>ê¸°ê°„</th><th>ê°€ì…ì ìˆ˜ (ê±´)</th><th>ë¹„ê³ </th></tr>
                </thead>
                <tbody>
                    <tr class="actual"><td>2024 Q3</td><td>4,112</td><td>ì‹¤ì </td></tr>
                    <tr class="actual"><td>2024 Q4</td><td>8,510</td><td>ì‹¤ì </td></tr>
                    <tr class="actual"><td>2025 Q1</td><td>13,864</td><td>ì‹¤ì </td></tr>
                    <tr class="actual"><td>2025 Q2</td><td>5,531</td><td>ì‹¤ì </td></tr>
                    <tr class="actual"><td>2025 Q3</td><td>8,176</td><td>ì‹¤ì </td></tr>
                    <tr class="actual"><td>2025 Q4</td><td>63,736</td><td>ì‹¤ì </td></tr>
                </tbody>
            </table>
            
            <h3 style="font-size: 16px; margin: 30px 0 10px 0;">ğŸ“‹ ë¯¸ë˜ ê°€ì… ê³„íš (3ê°œë…„)</h3>
            
            <div class="year-section">
                <h4>2026ë…„</h4>
                <table class="data-table">
                    <thead><tr><th>ê¸°ê°„</th><th>ê°€ì…ì ìˆ˜ (ê±´)</th></tr></thead>
                    <tbody>
                        <tr><td>2026 Q1</td><td><input type="number" id="enroll_2026q1" value="0" min="0" step="1000"></td></tr>
                        <tr><td>2026 Q2</td><td><input type="number" id="enroll_2026q2" value="0" min="0" step="1000"></td></tr>
                        <tr><td>2026 Q3</td><td><input type="number" id="enroll_2026q3" value="0" min="0" step="1000"></td></tr>
                        <tr><td>2026 Q4</td><td><input type="number" id="enroll_2026q4" value="0" min="0" step="1000"></td></tr>
                    </tbody>
                </table>
            </div>
            
            <div class="year-section">
                <h4>2027ë…„</h4>
                <table class="data-table">
                    <thead><tr><th>ê¸°ê°„</th><th>ê°€ì…ì ìˆ˜ (ê±´)</th></tr></thead>
                    <tbody>
                        <tr><td>2027 Q1</td><td><input type="number" id="enroll_2027q1" value="0" min="0" step="1000"></td></tr>
                        <tr><td>2027 Q2</td><td><input type="number" id="enroll_2027q2" value="0" min="0" step="1000"></td></tr>
                        <tr><td>2027 Q3</td><td><input type="number" id="enroll_2027q3" value="0" min="0" step="1000"></td></tr>
                        <tr><td>2027 Q4</td><td><input type="number" id="enroll_2027q4" value="0" min="0" step="1000"></td></tr>
                    </tbody>
                </table>
            </div>
            
            <div class="year-section">
                <h4>2028ë…„</h4>
                <table class="data-table">
                    <thead><tr><th>ê¸°ê°„</th><th>ê°€ì…ì ìˆ˜ (ê±´)</th></tr></thead>
                    <tbody>
                        <tr><td>2028 Q1</td><td><input type="number" id="enroll_2028q1" value="0" min="0" step="1000"></td></tr>
                        <tr><td>2028 Q2</td><td><input type="number" id="enroll_2028q2" value="0" min="0" step="1000"></td></tr>
                        <tr><td>2028 Q3</td><td><input type="number" id="enroll_2028q3" value="0" min="0" step="1000"></td></tr>
                        <tr><td>2028 Q4</td><td><input type="number" id="enroll_2028q4" value="0" min="0" step="1000"></td></tr>
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- ë¶„ê¸°ë³„ í…Œì´ë¸” -->
        <div class="card">
            <h2>ğŸ“Š ë¶„ê¸°ë³„ ì‹¤ì  ë° ì˜ˆì¸¡</h2>
            <div style="overflow-x: auto;">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>ë¶„ê¸°</th>
                            <th>ì‹ ê·œ ê°€ì…<br>(ê±´)</th>
                            <th>ì „í™˜ ê³ ê°<br>(ëª…)</th>
                            <th>ë§¤ì¶œ<br>(ì–µì›)</th>
                            <th>ê³µí—Œì´ìµ<br>(ì–µì›)</th>
                            <th>ê³µí—Œì´ìµë¥ <br>(%)</th>
                            <th>êµ¬ë¶„</th>
                        </tr>
                    </thead>
                    <tbody id="quarterlyAllBody"></tbody>
                </table>
            </div>
            <div class="chart-container"><canvas id="quarterlyChart"></canvas></div>
        </div>
        
        <!-- ì›”ë³„ ìƒì„¸ -->
        <div class="card">
            <h2>ğŸ“ˆ ì›”ë³„ ìƒì„¸ ì˜ˆì¸¡ (2026-2028)</h2>
            <div style="overflow-x: auto;">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>ì›”</th>
                            <th>ì „í™˜ ê³ ê° (ëª…)</th>
                            <th>ë§¤ì¶œ (ë°±ë§Œì›)</th>
                            <th>ê³µí—Œì´ìµ (ë°±ë§Œì›)</th>
                            <th>ì£¼ìš” ê¸°ì—¬ ì½”í˜¸íŠ¸</th>
                        </tr>
                    </thead>
                    <tbody id="monthlyTableBody"></tbody>
                </table>
            </div>
            <div class="chart-container"><canvas id="conversionChart"></canvas></div>
        </div>
        
        <!-- ì½”í˜¸íŠ¸ ë¶„ì„ -->
        <div class="card">
            <h2>ğŸ‚ ì½”í˜¸íŠ¸ë³„ ê¸°ì—¬ë„ ë¶„ì„</h2>
            <div class="info-box success" id="cumulativeRatesBox"></div>
            <div class="chart-container"><canvas id="cohortChart"></canvas></div>
            <div style="overflow-x: auto; margin-top: 20px;">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>ì½”í˜¸íŠ¸ ì—°ë„</th>
                            <th>ëˆ„ì  ê°€ì…ì (ê±´)</th>
                            <th>2026ë…„ ì „í™˜ (ëª…)</th>
                            <th>2027ë…„ ì „í™˜ (ëª…)</th>
                            <th>2028ë…„ ì „í™˜ (ëª…)</th>
                        </tr>
                    </thead>
                    <tbody id="cohortBreakdownBody"></tbody>
                </table>
            </div>
        </div>
        
        <!-- ëª¨ë¸ ë¹„êµ -->
        <div class="card">
            <h2>ğŸ“‹ v2.2 vs v2.3 ëª¨ë¸ ë¹„êµ</h2>
            <table class="data-table">
                <thead><tr><th>í•­ëª©</th><th>v2.2</th><th>v2.3</th><th>ë³€ê²½ ì‚¬ìœ </th></tr></thead>
                <tbody>
                    <tr><td>1ë…„ì°¨ ì „í™˜ìœ¨</td><td>1.2%</td><td><strong>0.8%</strong></td><td>ì‹¤ì¸¡ ê°€ì¤‘í‰ê·  ê¸°ë°˜</td></tr>
                    <tr><td>ì›”ë³„ íŒ¨í„´</td><td>ê· ë“±</td><td><strong>Front-loaded</strong></td><td>ì „ë°˜ë¶€ 63% ì§‘ì¤‘ (ì‹¤ì¸¡)</td></tr>
                    <tr><td>10ë…„ ëˆ„ì </td><td>10.3% (30%ê¸°ì¤€)</td><td><strong>7-9%</strong></td><td>ì‹œë‚˜ë¦¬ì˜¤ ì„ íƒ</td></tr>
                    <tr><td>2025 Q4</td><td>70,000 (ê³„íš)</td><td><strong>63,736 (ì‹¤ì )</strong></td><td>ì‹¤ì  ë°˜ì˜</td></tr>
                    <tr><td>ì˜ˆì¸¡ ë²”ìœ„</td><td>~2027</td><td><strong>~2028</strong></td><td>3ê°œë…„ ê³„íš</td></tr>
                </tbody>
            </table>
        </div>
    </div>

    <script>
        // ê³¼ê±° ì‹¤ì  ë°ì´í„° (ì›”ë³„)
        const historicalData = [
            { month: '2024-06', enroll: 512 },
            { month: '2024-07', enroll: 2109 },
            { month: '2024-08', enroll: 1519 },
            { month: '2024-09', enroll: 471 },
            { month: '2024-10', enroll: 1562 },
            { month: '2024-11', enroll: 2923 },
            { month: '2024-12', enroll: 4025 },
            { month: '2025-01', enroll: 4419 },
            { month: '2025-02', enroll: 5963 },
            { month: '2025-03', enroll: 3482 },
            { month: '2025-04', enroll: 2475 },
            { month: '2025-05', enroll: 2009 },
            { month: '2025-06', enroll: 1047 },
            { month: '2025-07', enroll: 1053 },
            { month: '2025-08', enroll: 1974 },
            { month: '2025-09', enroll: 5149 },
            { month: '2025-10', enroll: 15167 },
            { month: '2025-11', enroll: 19087 },
            { month: '2025-12', enroll: 29482 }
        ];
        
        // ì‹¤ì œ ë¶„ê¸°ë³„ ì „í™˜ (ê²€ì¦ìš©)
        const actualQuarterlyConversions = {
            '2024-Q3': 13,
            '2024-Q4': 23,
            '2025-Q1': 20,
            '2025-Q2': 86,
            '2025-Q3': 70,
            '2025-Q4': 205
        };
        
        // Unit Economics
        const unitEconomics = {
            legacy: { revenue: 3300000, goodsCost: 1458100, laborCost: 991900 },
            new2026: { revenue: 3400000, goodsCost: 1258100, laborCost: 1091900 }
        };
        
        let charts = {};
        
        // v2.3 1ë…„ì°¨ ì›”ë³„ ì „í™˜ìœ¨ (ì‹¤ì¸¡ ê¸°ë°˜ Front-loaded)
        const year1MonthlyWeights = [
            0.1420, 0.1388, 0.1109, 0.0659, 0.0993, 0.0735,
            0.0814, 0.0767, 0.0679, 0.0524, 0.0660, 0.0253
        ];
        
        function standardNormalCDF(z) {
            const sign = z >= 0 ? 1 : -1;
            const absZ = Math.abs(z);
            const t = 1 / (1 + 0.3275911 * absZ);
            const erf = 1 - (((((1.061405429 * t - 1.453152027) * t + 1.421413741) * t - 0.284496736) * t + 0.254829592) * t) * Math.exp(-z * z);
            return 0.5 * (1 + sign * erf);
        }
        
        function lognormalCDF(x, mu, sigma) {
            if (x <= 0) return 0;
            return standardNormalCDF((Math.log(x) - mu) / sigma);
        }
        
        function calculateConversionRates(finalRate) {
            const sigma = 1.0;
            const mu = Math.log(8) + sigma * sigma;
            
            const year1Rate = 0.008;
            const year1Monthly = year1MonthlyWeights.map(w => w * year1Rate);
            
            const remaining = (finalRate / 100) - year1Rate;
            const yearlyWeights = [];
            let totalWeight = 0;
            
            for (let year = 2; year <= 20; year++) {
                const weight = lognormalCDF(year + 0.5, mu, sigma) - lognormalCDF(year - 0.5, mu, sigma);
                yearlyWeights.push(weight);
                totalWeight += weight;
            }
            
            const monthlyRates = [...year1Monthly];
            
            for (let i = 0; i < yearlyWeights.length; i++) {
                const yearRate = (yearlyWeights[i] / totalWeight) * remaining;
                for (let m = 0; m < 12; m++) {
                    monthlyRates.push(yearRate / 12);
                }
            }
            
            return monthlyRates;
        }
        
        function getMonthsDiff(fromMonth, toMonth) {
            const [fromY, fromM] = fromMonth.split('-').map(Number);
            const [toY, toM] = toMonth.split('-').map(Number);
            return (toY - fromY) * 12 + (toM - fromM);
        }
        
        function getQuarter(month) {
            const [year, m] = month.split('-');
            return `${year}-Q${Math.ceil(parseInt(m) / 3)}`;
        }
        
        function simulate() {
            const scenarioEl = document.querySelector('input[name="scenario"]:checked');
            const scenario = scenarioEl ? scenarioEl.value : 'conservative';
            const finalRate = scenario === 'conservative' ? 20 : 25;
            
            const monthlyRates = calculateConversionRates(finalRate);
            const allCohorts = [...historicalData];
            
            // 2026 Q1 (1-3ì›”)
            const q1_2026 = parseFloat(document.getElementById('enroll_2026q1').value) || 0;
            ['2026-01', '2026-02', '2026-03'].forEach(m => allCohorts.push({ month: m, enroll: q1_2026 / 3 }));
            
            // 2026 Q2-Q4
            [
                { id: 'enroll_2026q2', months: ['2026-04', '2026-05', '2026-06'] },
                { id: 'enroll_2026q3', months: ['2026-07', '2026-08', '2026-09'] },
                { id: 'enroll_2026q4', months: ['2026-10', '2026-11', '2026-12'] }
            ].forEach(q => {
                const val = parseFloat(document.getElementById(q.id).value) || 0;
                q.months.forEach(m => allCohorts.push({ month: m, enroll: val / 3 }));
            });
            
            // 2027
            [
                { id: 'enroll_2027q1', months: ['2027-01', '2027-02', '2027-03'] },
                { id: 'enroll_2027q2', months: ['2027-04', '2027-05', '2027-06'] },
                { id: 'enroll_2027q3', months: ['2027-07', '2027-08', '2027-09'] },
                { id: 'enroll_2027q4', months: ['2027-10', '2027-11', '2027-12'] }
            ].forEach(q => {
                const val = parseFloat(document.getElementById(q.id).value) || 0;
                q.months.forEach(m => allCohorts.push({ month: m, enroll: val / 3 }));
            });
            
            // 2028
            [
                { id: 'enroll_2028q1', months: ['2028-01', '2028-02', '2028-03'] },
                { id: 'enroll_2028q2', months: ['2028-04', '2028-05', '2028-06'] },
                { id: 'enroll_2028q3', months: ['2028-07', '2028-08', '2028-09'] },
                { id: 'enroll_2028q4', months: ['2028-10', '2028-11', '2028-12'] }
            ].forEach(q => {
                const val = parseFloat(document.getElementById(q.id).value) || 0;
                q.months.forEach(m => allCohorts.push({ month: m, enroll: val / 3 }));
            });
            
            // ì „ì²´ ì›” ìƒì„± (2024-07 ~ 2028-12)
            const allMonths = [];
            for (let y = 2024; y <= 2028; y++) {
                const startM = y === 2024 ? 7 : 1;
                for (let m = startM; m <= 12; m++) {
                    allMonths.push(`${y}-${String(m).padStart(2, '0')}`);
                }
            }
            
            const monthlyResults = allMonths.map(targetMonth => {
                let totalConversion = 0;
                const cohortContributions = {};
                
                allCohorts.forEach(cohort => {
                    const monthsElapsed = getMonthsDiff(cohort.month, targetMonth);
                    if (monthsElapsed >= 0 && monthsElapsed < monthlyRates.length) {
                        const conversion = cohort.enroll * monthlyRates[monthsElapsed];
                        totalConversion += conversion;
                        const cohortYear = cohort.month.split('-')[0];
                        cohortContributions[cohortYear] = (cohortContributions[cohortYear] || 0) + conversion;
                    }
                });
                
                let revenue = 0, contribution = 0;
                Object.entries(cohortContributions).forEach(([year, converts]) => {
                    const ue = parseInt(year) >= 2026 ? unitEconomics.new2026 : unitEconomics.legacy;
                    revenue += converts * ue.revenue;
                    contribution += converts * (ue.revenue - ue.goodsCost - ue.laborCost);
                });
                
                return {
                    month: targetMonth,
                    quarter: getQuarter(targetMonth),
                    conversion: totalConversion,
                    revenue, contribution, cohortContributions
                };
            });
            
            return { monthlyResults, allCohorts, finalRate };
        }
        
        function updateUI() {
            const { monthlyResults, allCohorts, finalRate } = simulate();
            
            // ë¶„ê¸°ë³„ ì§‘ê³„
            const quarterlyData = {};
            monthlyResults.forEach(m => {
                if (!quarterlyData[m.quarter]) {
                    quarterlyData[m.quarter] = { conversion: 0, revenue: 0, contribution: 0, enroll: 0 };
                }
                quarterlyData[m.quarter].conversion += m.conversion;
                quarterlyData[m.quarter].revenue += m.revenue;
                quarterlyData[m.quarter].contribution += m.contribution;
            });
            
            allCohorts.forEach(cohort => {
                const q = getQuarter(cohort.month);
                if (quarterlyData[q]) quarterlyData[q].enroll += cohort.enroll;
            });
            
            // ì—°ë„ë³„ Summary
            ['2026', '2027', '2028'].forEach(year => {
                const yearData = monthlyResults.filter(m => m.month.startsWith(year));
                const total = yearData.reduce((acc, m) => ({
                    conversion: acc.conversion + m.conversion,
                    revenue: acc.revenue + m.revenue
                }), { conversion: 0, revenue: 0 });
                
                document.getElementById(`total${year}Conversion`).innerHTML = 
                    Math.round(total.conversion).toLocaleString() + '<span class="summary-unit">ëª…</span>';
                document.getElementById(`total${year}Revenue`).innerHTML = 
                    (total.revenue / 100000000).toFixed(1) + '<span class="summary-unit">ì–µ</span>';
            });
            
            // ëˆ„ì  ì „í™˜ìœ¨ í‘œì‹œ (10ë…„ê¹Œì§€)
            const cumulativeRates = [];
            let cumul = 0;
            const monthlyRates = calculateConversionRates(finalRate);
            for (let y = 1; y <= 10; y++) {
                for (let m = 0; m < 12; m++) {
                    cumul += monthlyRates[(y-1)*12 + m] || 0;
                }
                if ([1, 2, 3, 5, 10].includes(y)) {
                    cumulativeRates.push(`${y}ë…„ì°¨: ${(cumul*100).toFixed(1)}%`);
                }
            }
            document.getElementById('cumulativeRatesBox').innerHTML = 
                `<strong>ğŸ“Š v2.3 ì—°ë„ë³„ ëˆ„ì  ì „í™˜ìœ¨ (10ë…„ ${finalRate === 20 ? '7%' : '9%'} ì‹œë‚˜ë¦¬ì˜¤):</strong><br>` + cumulativeRates.join(' | ');
            
            // ë¶„ê¸°ë³„ í…Œì´ë¸”
            const quarters = [];
            for (let y = 2024; y <= 2028; y++) {
                const startQ = y === 2024 ? 3 : 1;
                for (let q = startQ; q <= 4; q++) quarters.push(`${y}-Q${q}`);
            }
            
            let quarterlyHtml = '';
            quarters.forEach(q => {
                const data = quarterlyData[q] || { enroll: 0, conversion: 0, revenue: 0, contribution: 0 };
                const isActual = actualQuarterlyConversions[q] !== undefined;
                const rowClass = isActual ? 'actual' : 'forecast';
                const conversion = isActual ? actualQuarterlyConversions[q] : data.conversion;
                const revenue = isActual ? actualQuarterlyConversions[q] * unitEconomics.legacy.revenue : data.revenue;
                const contribution = isActual ? 
                    actualQuarterlyConversions[q] * (unitEconomics.legacy.revenue - unitEconomics.legacy.goodsCost - unitEconomics.legacy.laborCost) : 
                    data.contribution;
                const margin = revenue > 0 ? (contribution / revenue) * 100 : 0;
                
                quarterlyHtml += `
                    <tr class="${rowClass}">
                        <td>${q}</td>
                        <td>${Math.round(data.enroll).toLocaleString()}</td>
                        <td>${isActual ? conversion : Math.round(conversion)}</td>
                        <td>${(revenue / 100000000).toFixed(2)}</td>
                        <td>${(contribution / 100000000).toFixed(2)}</td>
                        <td>${margin.toFixed(1)}</td>
                        <td><strong>${isActual ? 'ì‹¤ì ' : 'ì˜ˆì¸¡'}</strong></td>
                    </tr>`;
            });
            document.getElementById('quarterlyAllBody').innerHTML = quarterlyHtml;
            
            // ì›”ë³„ í…Œì´ë¸” (2026-2028)
            const targetMonths = monthlyResults.filter(m => {
                const year = parseInt(m.month.split('-')[0]);
                return year >= 2026;
            });
            
            let monthlyHtml = '';
            targetMonths.forEach(m => {
                const topCohorts = Object.entries(m.cohortContributions)
                    .sort((a, b) => b[1] - a[1])
                    .slice(0, 2)
                    .map(([year]) => year)
                    .join(', ');
                
                monthlyHtml += `
                    <tr>
                        <td>${m.month}</td>
                        <td>${Math.round(m.conversion)}</td>
                        <td>${(m.revenue / 1000000).toFixed(1)}</td>
                        <td>${(m.contribution / 1000000).toFixed(1)}</td>
                        <td>${topCohorts}</td>
                    </tr>`;
            });
            document.getElementById('monthlyTableBody').innerHTML = monthlyHtml;
            
            // ì½”í˜¸íŠ¸ë³„ ê¸°ì—¬ë„
            const cohortYears = ['2024', '2025', '2026', '2027', '2028'];
            const cohortBreakdown = cohortYears.map(year => {
                const yearCohorts = allCohorts.filter(c => c.month.startsWith(year));
                const totalEnroll = yearCohorts.reduce((sum, c) => sum + c.enroll, 0);
                
                const conv2026 = monthlyResults.filter(m => m.month.startsWith('2026'))
                    .reduce((sum, m) => sum + (m.cohortContributions[year] || 0), 0);
                const conv2027 = monthlyResults.filter(m => m.month.startsWith('2027'))
                    .reduce((sum, m) => sum + (m.cohortContributions[year] || 0), 0);
                const conv2028 = monthlyResults.filter(m => m.month.startsWith('2028'))
                    .reduce((sum, m) => sum + (m.cohortContributions[year] || 0), 0);
                
                return { year, totalEnroll, conv2026, conv2027, conv2028 };
            });
            
            let cohortHtml = '';
            cohortBreakdown.forEach(c => {
                cohortHtml += `
                    <tr>
                        <td>${c.year}</td>
                        <td>${Math.round(c.totalEnroll).toLocaleString()}</td>
                        <td>${Math.round(c.conv2026)}</td>
                        <td>${Math.round(c.conv2027)}</td>
                        <td>${Math.round(c.conv2028)}</td>
                    </tr>`;
            });
            document.getElementById('cohortBreakdownBody').innerHTML = cohortHtml;
            
            // ì°¨íŠ¸ ì—…ë°ì´íŠ¸
            updateCharts(quarters, quarterlyData, targetMonths, cohortBreakdown);
        }
        
        function updateCharts(quarters, quarterlyData, targetMonths, cohortBreakdown) {
            // ë¶„ê¸°ë³„ ì°¨íŠ¸
            if (charts.quarterly) charts.quarterly.destroy();
            const ctx0 = document.getElementById('quarterlyChart').getContext('2d');
            
            const actualData = quarters.map(q => actualQuarterlyConversions[q] || null);
            const forecastData = quarters.map(q => {
                if (actualQuarterlyConversions[q]) return null;
                return quarterlyData[q] ? Math.round(quarterlyData[q].conversion) : 0;
            });
            
            charts.quarterly = new Chart(ctx0, {
                type: 'bar',
                data: {
                    labels: quarters,
                    datasets: [
                        { label: 'ì‹¤ì ', data: actualData, backgroundColor: '#38a169' },
                        { label: 'ì˜ˆì¸¡', data: forecastData, backgroundColor: '#f18334' }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { position: 'top' } },
                    scales: { y: { beginAtZero: true, title: { display: true, text: 'ì „í™˜ (ëª…)' } } }
                }
            });
            
            // ì›”ë³„ ì°¨íŠ¸
            if (charts.conversion) charts.conversion.destroy();
            const ctx1 = document.getElementById('conversionChart').getContext('2d');
            charts.conversion = new Chart(ctx1, {
                type: 'line',
                data: {
                    labels: targetMonths.map(m => m.month),
                    datasets: [{
                        label: 'ì „í™˜ ê³ ê°',
                        data: targetMonths.map(m => Math.round(m.conversion)),
                        borderColor: '#f18334',
                        backgroundColor: 'rgba(241, 131, 52, 0.1)',
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: { y: { beginAtZero: true } }
                }
            });
            
            // ì½”í˜¸íŠ¸ ì°¨íŠ¸
            if (charts.cohort) charts.cohort.destroy();
            const ctx2 = document.getElementById('cohortChart').getContext('2d');
            charts.cohort = new Chart(ctx2, {
                type: 'bar',
                data: {
                    labels: cohortBreakdown.map(c => c.year + 'ë…„'),
                    datasets: [
                        { label: '2026ë…„ ì „í™˜', data: cohortBreakdown.map(c => Math.round(c.conv2026)), backgroundColor: '#3b82f6' },
                        { label: '2027ë…„ ì „í™˜', data: cohortBreakdown.map(c => Math.round(c.conv2027)), backgroundColor: '#10b981' },
                        { label: '2028ë…„ ì „í™˜', data: cohortBreakdown.map(c => Math.round(c.conv2028)), backgroundColor: '#f59e0b' }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { position: 'top' } },
                    scales: { x: { stacked: false }, y: { beginAtZero: true } }
                }
            });
        }
        
        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        document.querySelectorAll('input').forEach(input => {
            input.addEventListener('input', updateUI);
        });
        document.querySelectorAll('input[type="radio"]').forEach(radio => {
            radio.addEventListener('change', updateUI);
        });
        
        updateUI();
    </script>
</body>
</html>
