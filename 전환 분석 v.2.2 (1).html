<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê³ ì´ ìƒì¡° í”„ë¡œì ì…˜ íˆ´ v2.2</title>
    <link href="https://cdn.jsdelivr.net/gh/spoqa/spoqa-han-sans@latest/css/SpoqaHanSansNeo.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Spoqa Han Sans Neo', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #f5f7fa;
            color: #2c3e50;
            font-size: 14px;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        header {
            background: linear-gradient(135deg, #f18334 0%, #e76f1f 100%);
            color: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(241, 131, 52, 0.3);
            margin-bottom: 30px;
        }
        
        h1 {
            font-size: 28px;
            margin-bottom: 8px;
            font-weight: 700;
        }
        
        .subtitle {
            opacity: 0.95;
            font-size: 14px;
        }
        
        .card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            margin-bottom: 20px;
        }
        
        .card h2 {
            font-size: 18px;
            margin-bottom: 20px;
            color: #2c3e50;
            border-bottom: 2px solid #f18334;
            padding-bottom: 10px;
            font-weight: 700;
        }
        
        .summary-box {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .summary-item {
            background: #edeae9;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
        }
        
        .summary-label {
            font-size: 12px;
            color: #6c757d;
            margin-bottom: 8px;
        }
        
        .summary-value {
            font-size: 28px;
            font-weight: 700;
            color: #f18334;
        }
        
        .summary-unit {
            font-size: 14px;
            color: #6c757d;
            margin-left: 3px;
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        
        .data-table th, .data-table td {
            padding: 12px;
            text-align: center;
            border: 1px solid #e9ecef;
            font-size: 13px;
        }
        
        .data-table th {
            background: #f8f9fa;
            font-weight: 600;
            color: #495057;
        }
        
        .data-table input {
            width: 100%;
            padding: 8px;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            font-size: 13px;
            text-align: center;
        }
        
        .data-table .actual {
            background: #e8f5e9;
        }
        
        .data-table .forecast {
            background: #fff3e0;
        }
        
        .data-table .highlight {
            font-weight: 700;
            background: #f8f9fa;
        }
        
        .info-box {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 4px;
            font-size: 13px;
            line-height: 1.6;
        }
        
        .chart-container {
            position: relative;
            height: 350px;
            margin-top: 20px;
        }
        
        @media (max-width: 1024px) {
            .summary-box {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ“Š ê³ ì´ ìƒì¡° í”„ë¡œì ì…˜ íˆ´ v2.2</h1>
            <p class="subtitle">Lognormal ì „í™˜ìœ¨ ëª¨ë¸ (v2.2, 251123) Â· 2024 Q3 ~ 2027ë…„ ì˜ˆì¸¡</p>
        </header>
        
        <!-- í†µí•© Summary -->
        <div class="card">
            <h2>ğŸ¯ 2026ë…„ ì˜ˆì¸¡ ê²°ê³¼</h2>
            <div class="summary-box">
                <div class="summary-item">
                    <div class="summary-label">ì´ ì „í™˜ ê³ ê°</div>
                    <div class="summary-value" id="total2026Conversion">-<span class="summary-unit">ëª…</span></div>
                </div>
                <div class="summary-item">
                    <div class="summary-label">ì´ ë§¤ì¶œ</div>
                    <div class="summary-value" id="total2026Revenue">-<span class="summary-unit">ì–µì›</span></div>
                </div>
                <div class="summary-item">
                    <div class="summary-label">ì´ ê³µí—Œì´ìµ</div>
                    <div class="summary-value" id="total2026Contribution">-<span class="summary-unit">ì–µì›</span></div>
                </div>
                <div class="summary-item">
                    <div class="summary-label">ê³µí—Œì´ìµë¥ </div>
                    <div class="summary-value" id="total2026Margin">-<span class="summary-unit">%</span></div>
                </div>
            </div>
        </div>
        
        <!-- Input Section -->
        <div class="card">
            <h2>ğŸ“¥ ê°€ì… ê³„íš ì…ë ¥</h2>
            
            <div class="info-box">
                <strong>ğŸ“Œ ì „í™˜ìœ¨ ëª¨ë¸ (v2.2, 251123):</strong> Lognormal ë¸Œëœë“œ ê°•í™” ì‹œë‚˜ë¦¬ì˜¤ (20ë…„ ëˆ„ì  30%) ì ìš©.<br>
                ìµœê·¼ ì‹¤ì  ë°ì´í„°ë¥¼ ë°˜ì˜í•˜ì—¬ 1ë…„ì°¨ ì „í™˜ìœ¨ 1.2%, ë¸Œëœë“œ íš¨ê³¼ ë° CRM ê°œì„ ì„ ê³ ë ¤í•œ ì¥ê¸° ì „í™˜ìœ¨ ìƒí–¥ ì¡°ì •.
            </div>
            
            <h3 style="font-size: 16px; margin: 20px 0 10px 0;">ê³¼ê±° ê°€ì… ì‹¤ì </h3>
            <table class="data-table">
                <thead>
                    <tr>
                        <th>ê¸°ê°„</th>
                        <th>ê°€ì…ì ìˆ˜ (ê±´)</th>
                    </tr>
                </thead>
                <tbody>
                    <tr class="actual">
                        <td>2024 Q3</td>
                        <td>4,112</td>
                    </tr>
                    <tr class="actual">
                        <td>2024 Q4</td>
                        <td>8,510</td>
                    </tr>
                    <tr class="actual">
                        <td>2025 Q1</td>
                        <td>12,864</td>
                    </tr>
                    <tr class="actual">
                        <td>2025 Q2</td>
                        <td>6,006</td>
                    </tr>
                    <tr class="actual">
                        <td>2025 Q3</td>
                        <td>7,617</td>
                    </tr>
                </tbody>
            </table>
            
            <h3 style="font-size: 16px; margin: 20px 0 10px 0;">ë¯¸ë˜ ê°€ì… ê³„íš</h3>
            <table class="data-table">
                <thead>
                    <tr>
                        <th>ê¸°ê°„</th>
                        <th>ê°€ì…ì ìˆ˜ (ê±´)</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>2025 Q4</td>
                        <td><input type="number" id="enroll_2025q4" value="70000" min="0" step="1000"></td>
                    </tr>
                    <tr>
                        <td>2026 Q1</td>
                        <td><input type="number" id="enroll_2026q1" value="50000" min="0" step="1000"></td>
                    </tr>
                    <tr>
                        <td>2026 Q2</td>
                        <td><input type="number" id="enroll_2026q2" value="50000" min="0" step="1000"></td>
                    </tr>
                    <tr>
                        <td>2026 Q3</td>
                        <td><input type="number" id="enroll_2026q3" value="50000" min="0" step="1000"></td>
                    </tr>
                    <tr>
                        <td>2026 Q4</td>
                        <td><input type="number" id="enroll_2026q4" value="50000" min="0" step="1000"></td>
                    </tr>
                    <tr>
                        <td>2027 Q1</td>
                        <td><input type="number" id="enroll_2027q1" value="50000" min="0" step="1000"></td>
                    </tr>
                    <tr>
                        <td>2027 Q2</td>
                        <td><input type="number" id="enroll_2027q2" value="50000" min="0" step="1000"></td>
                    </tr>
                    <tr>
                        <td>2027 Q3</td>
                        <td><input type="number" id="enroll_2027q3" value="50000" min="0" step="1000"></td>
                    </tr>
                    <tr>
                        <td>2027 Q4</td>
                        <td><input type="number" id="enroll_2027q4" value="50000" min="0" step="1000"></td>
                    </tr>
                </tbody>
            </table>
        </div>
        
        <!-- í†µí•© ë¶„ê¸°ë³„ í…Œì´ë¸” -->
        <div class="card">
            <h2>ğŸ“Š ë¶„ê¸°ë³„ ì‹¤ì  ë° ì˜ˆì¸¡ (2024 Q3 ~ 2027 Q4)</h2>
            
            <div style="overflow-x: auto;">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>ë¶„ê¸°</th>
                            <th>ì‹ ê·œ ê°€ì…<br>(ê±´)</th>
                            <th>ì „í™˜ ê³ ê°<br>(ëª…)</th>
                            <th>ë§¤ì¶œ<br>(ì–µì›)</th>
                            <th>ê³µí—Œì´ìµ<br>(ì–µì›)</th>
                            <th>ê³µí—Œì´ìµë¥ <br>(%)</th>
                            <th>êµ¬ë¶„</th>
                        </tr>
                    </thead>
                    <tbody id="quarterlyAllBody">
                    </tbody>
                </table>
            </div>
            
            <div class="chart-container" style="margin-top: 30px;">
                <canvas id="quarterlyChart"></canvas>
            </div>
        </div>
        
        <!-- 2026 ì›”ë³„ ìƒì„¸ -->
        <div class="card">
            <h2>ğŸ“ˆ 2025 Q4 ~ 2026ë…„ ì›”ë³„ ìƒì„¸ ì˜ˆì¸¡</h2>
            
            <div style="overflow-x: auto;">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>ì›”</th>
                            <th>ì „í™˜ ê³ ê°<br>(ëª…)</th>
                            <th>ë§¤ì¶œ<br>(ë°±ë§Œì›)</th>
                            <th>ê³µí—Œì´ìµ<br>(ë°±ë§Œì›)</th>
                            <th>ì£¼ìš” ê¸°ì—¬ ì½”í˜¸íŠ¸</th>
                        </tr>
                    </thead>
                    <tbody id="monthlyTableBody">
                    </tbody>
                </table>
            </div>
            
            <div class="chart-container">
                <canvas id="conversionChart"></canvas>
            </div>
        </div>
        
        <!-- Cohort Breakdown -->
        <div class="card">
            <h2>ğŸ‚ ì½”í˜¸íŠ¸ë³„ ê¸°ì—¬ë„ ë¶„ì„ (2026ë…„)</h2>
            
            <div class="info-box">
                <strong>ğŸ“Š ì—°ë„ë³„ ëˆ„ì  ì „í™˜ìœ¨ (v2.2 ë¸Œëœë“œ ê°•í™” ëª¨ë¸):</strong><br>
                1ë…„ì°¨: 1.2% | 2ë…„ì°¨: 1.9% | 3ë…„ì°¨: 2.9% | 4ë…„ì°¨: 4.3% | 5ë…„ì°¨: 6.0% | 
                10ë…„ì°¨: 15.8% | 15ë…„ì°¨: 25.2% | 20ë…„ì°¨: 30.0%
            </div>
            
            <div class="chart-container">
                <canvas id="cohortChart"></canvas>
            </div>
            
            <div style="overflow-x: auto; margin-top: 20px;">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>ì½”í˜¸íŠ¸ ì—°ë„</th>
                            <th>ëˆ„ì  ê°€ì…ì<br>(ê±´)</th>
                            <th>2026ë…„ ì „í™˜<br>(ëª…)</th>
                            <th>ê¸°ì—¬ ë¹„ì¤‘<br>(%)</th>
                            <th>2026ë…„ ë§¤ì¶œ<br>(ì–µì›)</th>
                        </tr>
                    </thead>
                    <tbody id="cohortBreakdownBody">
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        // ê³¼ê±° ì‹¤ì  ë°ì´í„°
        const historicalData = [
            { month: '2024-06', enroll: 512 },
            { month: '2024-07', enroll: 2109 },
            { month: '2024-08', enroll: 1519 },
            { month: '2024-09', enroll: 471 },
            { month: '2024-10', enroll: 1562 },
            { month: '2024-11', enroll: 2923 },
            { month: '2024-12', enroll: 4025 },
            { month: '2025-01', enroll: 4419 },
            { month: '2025-02', enroll: 5963 },
            { month: '2025-03', enroll: 3482 },
            { month: '2025-04', enroll: 2475 },
            { month: '2025-05', enroll: 2009 },
            { month: '2025-06', enroll: 1047 },
            { month: '2025-07', enroll: 1053 },
            { month: '2025-08', enroll: 1974 },
            { month: '2025-09', enroll: 4590 }
        ];
        
        // ì‹¤ì œ ë¶„ê¸°ë³„ ì „í™˜ (ê²€ì¦ìš©)
        const actualQuarterlyConversions = {
            '2024-Q3': 13,
            '2024-Q4': 23,
            '2025-Q1': 20,
            '2025-Q2': 86,
            '2025-Q3': 70
        };
        
        // Unit Economics
        const unitEconomics = {
            legacy: {
                revenue: 3300000,
                goodsCost: 1458100,
                laborCost: 991900
            },
            new2026: {
                revenue: 3400000,
                goodsCost: 1258100,
                laborCost: 1091900
            }
        };
        
        let charts = {};
        
        // Lognormal CDF
        function standardNormalCDF(z) {
            const sign = z >= 0 ? 1 : -1;
            const absZ = Math.abs(z);
            const t = 1 / (1 + 0.3275911 * absZ);
            const erf = 1 - (((((1.061405429 * t - 1.453152027) * t + 1.421413741) * t - 0.284496736) * t + 0.254829592) * t) * Math.exp(-z * z);
            return 0.5 * (1 + sign * erf);
        }
        
        function lognormalCDF(x, mu, sigma) {
            if (x <= 0) return 0;
            const z = (Math.log(x) - mu) / sigma;
            return standardNormalCDF(z);
        }
        
        function calculateConversionRates(finalRate) {
            const sigma = 1.0;
            const mu = Math.log(8) + sigma * sigma;
            const rates = [];
            const year1Rate = 0.012; // v2.2: 1.2%
            rates.push(year1Rate);
            
            const remaining = (finalRate / 100) - year1Rate;
            const weights = [];
            let totalWeight = 0;
            
            for (let year = 2; year <= 15; year++) {
                const weight = lognormalCDF(year + 0.5, mu, sigma) - lognormalCDF(year - 0.5, mu, sigma);
                weights.push(weight);
                totalWeight += weight;
            }
            
            for (let i = 0; i < weights.length; i++) {
                rates.push((weights[i] / totalWeight) * remaining);
            }
            
            // ì›”ë³„ ë³€í™˜ (ê· ë“± ë¶„ë°°)
            const monthlyRates = [];
            rates.forEach(yearRate => {
                for (let m = 0; m < 12; m++) {
                    monthlyRates.push(yearRate / 12);
                }
            });
            
            return monthlyRates;
        }
        
        function getMonthsDiff(fromMonth, toMonth) {
            const [fromY, fromM] = fromMonth.split('-').map(Number);
            const [toY, toM] = toMonth.split('-').map(Number);
            return (toY - fromY) * 12 + (toM - fromM);
        }
        
        function getQuarter(month) {
            const [year, m] = month.split('-');
            const q = Math.ceil(parseInt(m) / 3);
            return `${year}-Q${q}`;
        }
        
        function simulate() {
            const scenario = 30; // v2.2: 30%
            const monthlyRates = calculateConversionRates(scenario);
            
            // ëª¨ë“  ì½”í˜¸íŠ¸ ìˆ˜ì§‘
            const allCohorts = [...historicalData];
            
            // 2025 Q4 ì¶”ê°€
            const q4_2025 = parseFloat(document.getElementById('enroll_2025q4').value) || 0;
            ['2025-10', '2025-11', '2025-12'].forEach(month => {
                allCohorts.push({ 
                    month, 
                    enroll: q4_2025 / 3
                });
            });
            
            // 2026ë…„ ë¶„ê¸°ë³„ ì¶”ê°€
            const quarters = [
                { id: 'enroll_2026q1', months: ['2026-01', '2026-02', '2026-03'] },
                { id: 'enroll_2026q2', months: ['2026-04', '2026-05', '2026-06'] },
                { id: 'enroll_2026q3', months: ['2026-07', '2026-08', '2026-09'] },
                { id: 'enroll_2026q4', months: ['2026-10', '2026-11', '2026-12'] }
            ];
            
            quarters.forEach(q => {
                const qEnroll = parseFloat(document.getElementById(q.id).value) || 0;
                q.months.forEach(month => {
                    allCohorts.push({ 
                        month, 
                        enroll: qEnroll / 3
                    });
                });
            });
            
            // 2027ë…„ ë¶„ê¸°ë³„ ì¶”ê°€
            const quarters2027 = [
                { id: 'enroll_2027q1', months: ['2027-01', '2027-02', '2027-03'] },
                { id: 'enroll_2027q2', months: ['2027-04', '2027-05', '2027-06'] },
                { id: 'enroll_2027q3', months: ['2027-07', '2027-08', '2027-09'] },
                { id: 'enroll_2027q4', months: ['2027-10', '2027-11', '2027-12'] }
            ];
            
            quarters2027.forEach(q => {
                const qEnroll = parseFloat(document.getElementById(q.id).value) || 0;
                q.months.forEach(month => {
                    allCohorts.push({ 
                        month, 
                        enroll: qEnroll / 3
                    });
                });
            });
            
            // ì „ì²´ ê¸°ê°„ ì›”ë³„ ê³„ì‚° (2024-07 ~ 2027-12)
            const allMonths = [];
            for (let y = 2024; y <= 2027; y++) {
                const startM = y === 2024 ? 7 : 1;
                const endM = 12;
                for (let m = startM; m <= endM; m++) {
                    allMonths.push(`${y}-${String(m).padStart(2, '0')}`);
                }
            }
            
            const monthlyResults = allMonths.map(targetMonth => {
                let totalConversion = 0;
                const cohortContributions = {};
                
                allCohorts.forEach(cohort => {
                    const monthsElapsed = getMonthsDiff(cohort.month, targetMonth);
                    if (monthsElapsed >= 0 && monthsElapsed < monthlyRates.length) {
                        const conversion = cohort.enroll * monthlyRates[monthsElapsed];
                        totalConversion += conversion;
                        
                        const cohortYear = cohort.month.split('-')[0];
                        cohortContributions[cohortYear] = (cohortContributions[cohortYear] || 0) + conversion;
                    }
                });
                
                // ë§¤ì¶œ/ê³µí—Œì´ìµ ê³„ì‚°
                let revenue = 0;
                let contribution = 0;
                
                Object.entries(cohortContributions).forEach(([year, converts]) => {
                    const ue = (year === '2026' || year === '2027') ? unitEconomics.new2026 : unitEconomics.legacy;
                    revenue += converts * ue.revenue;
                    contribution += converts * (ue.revenue - ue.goodsCost - ue.laborCost);
                });
                
                return {
                    month: targetMonth,
                    quarter: getQuarter(targetMonth),
                    conversion: totalConversion,
                    revenue,
                    contribution,
                    cohortContributions
                };
            });
            
            return { monthlyResults, allCohorts };
        }
        
        function updateUI() {
            const { monthlyResults, allCohorts } = simulate();
            
            // ë¶„ê¸°ë³„ ì§‘ê³„
            const quarterlyData = {};
            monthlyResults.forEach(m => {
                if (!quarterlyData[m.quarter]) {
                    quarterlyData[m.quarter] = {
                        conversion: 0,
                        revenue: 0,
                        contribution: 0,
                        enroll: 0
                    };
                }
                quarterlyData[m.quarter].conversion += m.conversion;
                quarterlyData[m.quarter].revenue += m.revenue;
                quarterlyData[m.quarter].contribution += m.contribution;
            });
            
            // ë¶„ê¸°ë³„ ê°€ì…ì ì§‘ê³„
            allCohorts.forEach(cohort => {
                const q = getQuarter(cohort.month);
                if (quarterlyData[q]) {
                    quarterlyData[q].enroll += cohort.enroll;
                }
            });
            
            // 2026ë…„ Summary
            const months2026 = monthlyResults.filter(m => m.month.startsWith('2026'));
            const total2026 = months2026.reduce((acc, m) => ({
                conversion: acc.conversion + m.conversion,
                revenue: acc.revenue + m.revenue,
                contribution: acc.contribution + m.contribution
            }), { conversion: 0, revenue: 0, contribution: 0 });
            
            document.getElementById('total2026Conversion').innerHTML = 
                Math.round(total2026.conversion) + '<span class="summary-unit">ëª…</span>';
            document.getElementById('total2026Revenue').innerHTML = 
                (total2026.revenue / 100000000).toFixed(1) + '<span class="summary-unit">ì–µì›</span>';
            document.getElementById('total2026Contribution').innerHTML = 
                (total2026.contribution / 100000000).toFixed(1) + '<span class="summary-unit">ì–µì›</span>';
            document.getElementById('total2026Margin').innerHTML = 
                ((total2026.contribution / total2026.revenue) * 100).toFixed(1) + '<span class="summary-unit">%</span>';
            
            // í†µí•© ë¶„ê¸°ë³„ í…Œì´ë¸”
            const quarterlyAllBody = document.getElementById('quarterlyAllBody');
            let quarterlyHtml = '';
            
            const quarters = ['2024-Q3', '2024-Q4', '2025-Q1', '2025-Q2', '2025-Q3', '2025-Q4', 
                            '2026-Q1', '2026-Q2', '2026-Q3', '2026-Q4',
                            '2027-Q1', '2027-Q2', '2027-Q3', '2027-Q4'];
            
            quarters.forEach(q => {
                const data = quarterlyData[q] || { enroll: 0, conversion: 0, revenue: 0, contribution: 0 };
                const isActual = actualQuarterlyConversions[q] !== undefined;
                const rowClass = isActual ? 'actual' : 'forecast';
                const label = isActual ? 'ì‹¤ì ' : 'ì˜ˆì¸¡';
                
                const conversion = isActual ? actualQuarterlyConversions[q] : data.conversion;
                const revenue = isActual ? 
                    actualQuarterlyConversions[q] * unitEconomics.legacy.revenue : 
                    data.revenue;
                const contribution = isActual ?
                    actualQuarterlyConversions[q] * (unitEconomics.legacy.revenue - unitEconomics.legacy.goodsCost - unitEconomics.legacy.laborCost) :
                    data.contribution;
                
                quarterlyHtml += `
                    <tr class="${rowClass}">
                        <td>${q}</td>
                        <td>${Math.round(data.enroll).toLocaleString()}</td>
                        <td>${isActual ? conversion : Math.round(conversion)}</td>
                        <td>${(revenue / 100000000).toFixed(2)}</td>
                        <td>${(contribution / 100000000).toFixed(2)}</td>
                        <td>${((contribution / revenue) * 100).toFixed(1)}</td>
                        <td><strong>${label}</strong></td>
                    </tr>
                `;
            });
            quarterlyAllBody.innerHTML = quarterlyHtml;
            
            // 2025 Q4 + 2026 ì›”ë³„ í…Œì´ë¸”
            const months2025q4And2026 = monthlyResults.filter(m => {
                const [year, month] = m.month.split('-').map(Number);
                return (year === 2025 && month >= 10) || year === 2026;
            });
            
            const monthlyBody = document.getElementById('monthlyTableBody');
            let monthlyHtml = '';
            months2025q4And2026.forEach(m => {
                const topCohorts = Object.entries(m.cohortContributions)
                    .sort((a, b) => b[1] - a[1])
                    .slice(0, 2)
                    .map(([year, _]) => year)
                    .join(', ');
                
                monthlyHtml += `
                    <tr>
                        <td>${m.month}</td>
                        <td>${Math.round(m.conversion)}</td>
                        <td>${(m.revenue / 1000000).toFixed(1)}</td>
                        <td>${(m.contribution / 1000000).toFixed(1)}</td>
                        <td>${topCohorts}</td>
                    </tr>
                `;
            });
            monthlyBody.innerHTML = monthlyHtml;
            
            // ì½”í˜¸íŠ¸ë³„ ê¸°ì—¬ë„ (2026ë…„ë§Œ)
            const cohortYears = ['2024', '2025', '2026', '2027'];
            const cohortBreakdown = cohortYears.map(year => {
                const yearCohorts = allCohorts.filter(c => c.month.startsWith(year));
                const totalEnroll = yearCohorts.reduce((sum, c) => sum + c.enroll, 0);
                
                let yearConversion = 0;
                let yearRevenue = 0;
                
                months2026.forEach(m => {
                    const converts = m.cohortContributions[year] || 0;
                    yearConversion += converts;
                    const ue = (year === '2026' || year === '2027') ? unitEconomics.new2026 : unitEconomics.legacy;
                    yearRevenue += converts * ue.revenue;
                });
                
                return {
                    year,
                    totalEnroll,
                    conversion: yearConversion,
                    revenue: yearRevenue,
                    share: total2026.conversion > 0 ? (yearConversion / total2026.conversion) * 100 : 0
                };
            });
            
            const cohortBreakdownBody = document.getElementById('cohortBreakdownBody');
            let cohortHtml = '';
            cohortBreakdown.forEach(c => {
                cohortHtml += `
                    <tr>
                        <td>${c.year}</td>
                        <td>${Math.round(c.totalEnroll).toLocaleString()}</td>
                        <td>${Math.round(c.conversion)}</td>
                        <td>${c.share.toFixed(1)}</td>
                        <td>${(c.revenue / 100000000).toFixed(2)}</td>
                    </tr>
                `;
            });
            cohortBreakdownBody.innerHTML = cohortHtml;
            
            // ì°¨íŠ¸ ì—…ë°ì´íŠ¸
            updateCharts(monthlyResults, quarterlyData, cohortBreakdown, months2025q4And2026);
        }
        
        function updateCharts(monthlyResults, quarterlyData, cohortBreakdown, months2025q4And2026) {
            // ë¶„ê¸°ë³„ ì°¨íŠ¸
            if (charts.quarterly) charts.quarterly.destroy();
            const ctx0 = document.getElementById('quarterlyChart').getContext('2d');
            
            const quarters = ['2024-Q3', '2024-Q4', '2025-Q1', '2025-Q2', '2025-Q3', '2025-Q4', 
                            '2026-Q1', '2026-Q2', '2026-Q3', '2026-Q4',
                            '2027-Q1', '2027-Q2', '2027-Q3', '2027-Q4'];
            
            const actualData = quarters.map(q => actualQuarterlyConversions[q] || null);
            const forecastData = quarters.map(q => {
                if (actualQuarterlyConversions[q]) return null;
                const data = quarterlyData[q];
                return data ? Math.round(data.conversion) : 0;
            });
            
            charts.quarterly = new Chart(ctx0, {
                type: 'bar',
                data: {
                    labels: quarters,
                    datasets: [
                        {
                            label: 'ì‹¤ì ',
                            data: actualData,
                            backgroundColor: '#38a169'
                        },
                        {
                            label: 'ì˜ˆì¸¡',
                            data: forecastData,
                            backgroundColor: '#f18334'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'top' }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: { display: true, text: 'ì „í™˜ ê³ ê° ìˆ˜ (ëª…)' }
                        }
                    }
                }
            });
            
            // ì›”ë³„ ì „í™˜ ì°¨íŠ¸ (2025 Q4 + 2026)
            if (charts.conversion) charts.conversion.destroy();
            const ctx1 = document.getElementById('conversionChart').getContext('2d');
            charts.conversion = new Chart(ctx1, {
                type: 'line',
                data: {
                    labels: months2025q4And2026.map(m => m.month),
                    datasets: [{
                        label: 'ì „í™˜ ê³ ê° ìˆ˜',
                        data: months2025q4And2026.map(m => Math.round(m.conversion)),
                        borderColor: '#f18334',
                        backgroundColor: 'rgba(241, 131, 52, 0.1)',
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: { display: true, text: 'ëª…' }
                        }
                    }
                }
            });
            
            // ì½”í˜¸íŠ¸ ê¸°ì—¬ë„ ì°¨íŠ¸
            if (charts.cohort) charts.cohort.destroy();
            const ctx2 = document.getElementById('cohortChart').getContext('2d');
            charts.cohort = new Chart(ctx2, {
                type: 'doughnut',
                data: {
                    labels: cohortBreakdown.map(c => c.year + 'ë…„ ì½”í˜¸íŠ¸'),
                    datasets: [{
                        data: cohortBreakdown.map(c => c.conversion),
                        backgroundColor: ['#3b82f6', '#10b981', '#f59e0b', '#ef4444']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'bottom' }
                    }
                }
            });
        }
        
        // Event listeners
        document.querySelectorAll('input').forEach(input => {
            input.addEventListener('input', updateUI);
        });
        
        // ì´ˆê¸° ì‹¤í–‰
        updateUI();
    </script>
</body>
</html>